
  Widget _buildMultidayResult(AttendanceWithDate record) {
    List recordMorning = record.list
        .where((element) =>
            element.code != 'cin2' &&
            element.code != 'cout2' &&
            element.code != 'cin3' &&
            element.code != 'cout3')
        .toList();
    List recordAfternoon = record.list
        .where((element) =>
            element.code != 'cin1' &&
            element.code != 'cout1' &&
            element.code != 'cin3' &&
            element.code != 'cout3')
        .toList();
    return ExpansionTile(
      collapsedBackgroundColor: Color(0xff254973),
      backgroundColor: Color(0xff254973),
      textColor: Colors.white,
      iconColor: Colors.white,
      initiallyExpanded: true,
      title: Text(
        getDateStringFromDateTime(record.date),
        style: const TextStyle(
          fontSize: 16,
          fontWeight: FontWeight.w500,
        ),
      ),
      children: [
        ListView.builder(
            shrinkWrap: true,
            physics: const ClampingScrollPhysics(),
            itemBuilder: (context, index) {
              AppLocalizations? local = AppLocalizations.of(context);
              bool isEnglish = isInEnglish(context);
              return afternoon
                  ? recordAfternoon.isEmpty
                      ? Text('data')
                      : Container(
                          padding: const EdgeInsets.symmetric(
                            horizontal: 25,
                            vertical: 8,
                          ),
                          color: index % 2 == 0 ? kDarkestBlue : kBlue,
                          child: Row(
                            mainAxisAlignment: MainAxisAlignment.spaceBetween,
                            children: [
                              Text(
                                DateFormat('dd/MM/yyyy HH:mm')
                                    .format(recordAfternoon[index].date),
                              ),
                              Row(
                                children: [
                                  Text(
                                    recordAfternoon[index].type == 'checkin'
                                        ? '${local?.checkIn}'
                                        : recordAfternoon[index].type ==
                                                'checkout'
                                            ? '${local?.checkOut}'
                                            : recordAfternoon[index].type ==
                                                    'absent'
                                                ? '${local?.absent}'
                                                : recordAfternoon[index].type ==
                                                        'permission'
                                                    ? '${local?.permission}'
                                                    : recordAfternoon[index]
                                                        .type
                                                        .toString(),
                                  ),
                                  PopupMenuButton(
                                    color: Colors.black,
                                    shape: const RoundedRectangleBorder(
                                        borderRadius: BorderRadius.all(
                                            Radius.circular(10))),
                                    onSelected: (int selectedValue) async {
                                      if (afternoon == true) {
                                        if (selectedValue == 0) {
                                          final int userId =
                                              recordAfternoon[index].userId;
                                          final int id =
                                              recordAfternoon[index].id;
                                          final String type =
                                              recordAfternoon[index].type;
                                          final DateTime date =
                                              recordAfternoon[index].date;
                                          final String? note =
                                              recordAfternoon[index].note;
                                          final String code =
                                              recordAfternoon[index].code;
                                          await Navigator.of(context).push(
                                            MaterialPageRoute(
                                              builder: (ctx) => AttedancesEdit(
                                                id: id,
                                                userId: userId,
                                                type: type,
                                                date: date,
                                                note: note,
                                                code: code,
                                              ),
                                            ),
                                          );
                                          fetchAttendanceById();
                                        }
                                        if (selectedValue == 1) {
                                          showDialog(
                                            context: context,
                                            builder: (ctx) => AlertDialog(
                                              title:
                                                  Text('${local?.areYouSure}'),
                                              content: Text(
                                                  '${local?.cannotUndone}'),
                                              actions: [
                                                OutlineButton(
                                                  onPressed: () {
                                                    Navigator.of(context).pop();
                                                    deleteData1(
                                                        recordAfternoon[index]
                                                            .id as int);
                                                  },
                                                  child: Text('${local?.yes}'),
                                                  borderSide: BorderSide(
                                                      color: Colors.green),
                                                ),
                                                OutlineButton(
                                                  onPressed: () {
                                                    Navigator.of(context).pop();
                                                  },
                                                  borderSide: BorderSide(
                                                      color: Colors.red),
                                                  child: Text('${local?.no}'),
                                                )
                                              ],
                                            ),
                                          );
                                        }
                                        if (selectedValue == 2) {
                                          final int userId =
                                              recordAfternoon[index].userId;
                                          final int id =
                                              recordAfternoon[index].id;
                                          final String type =
                                              recordAfternoon[index].type;
                                          final DateTime date =
                                              recordAfternoon[index].date;
                                          final String? note =
                                              recordAfternoon[index].note;
                                          final String userName =
                                              recordAfternoon[index]
                                                  .users!
                                                  .name;
                                          final String image =
                                              recordAfternoon[index]
                                                  .users
                                                  .image;
                                          await Navigator.of(context).push(
                                            MaterialPageRoute(
                                              builder: (ctx) =>
                                                  ViewAttendanceScreen(
                                                id: id,
                                                userId: userId,
                                                type: type,
                                                date: date,
                                                note: note,
                                                userName: userName,
                                                image: image,
                                              ),
                                            ),
                                          );
                                        }
                                      }
                                    },
                                    itemBuilder: (_) => [
                                      PopupMenuItem(
                                        child: Text(
                                          '${local?.optionView}',
                                          style: kParagraph.copyWith(
                                              fontWeight: FontWeight.bold),
                                        ),
                                        value: 2,
                                      ),
                                      if (record.list[0].users!.role == 'admin')
                                        PopupMenuItem(
                                          child: Text(
                                            '${local?.edit}',
                                            style: kParagraph.copyWith(
                                                fontWeight: FontWeight.bold),
                                          ),
                                          value: 0,
                                        ),
                                      if (record.list[0].users!.role == 'admin')
                                        PopupMenuItem(
                                          child: Text(
                                            '${local?.delete}',
                                            style: kParagraph.copyWith(
                                                fontWeight: FontWeight.bold),
                                          ),
                                          value: 1,
                                        ),
                                    ],
                                    icon: const Icon(Icons.more_vert),
                                  ),
                                ],
                              ),
                            ],
                          ),
                        )
                  : Container(
                      padding: const EdgeInsets.symmetric(
                        horizontal: 25,
                        vertical: 8,
                      ),
                      color: index % 2 == 0 ? kDarkestBlue : kBlue,
                      child: Row(
                        mainAxisAlignment: MainAxisAlignment.spaceBetween,
                        children: [
                          Text(
                            DateFormat('dd/MM/yyyy HH:mm')
                                .format(recordMorning[index].date),
                          ),
                          Row(
                            children: [
                              Text(
                                recordMorning[index].type == 'checkin'
                                    ? '${local?.checkIn}'
                                    : recordMorning[index].type == 'checkout'
                                        ? '${local?.checkOut}'
                                        : recordMorning[index].type == 'absent'
                                            ? '${local?.absent}'
                                            : recordMorning[index].type ==
                                                    'permission'
                                                ? '${local?.permission}'
                                                : recordMorning[index]
                                                    .type
                                                    .toString(),
                              ),
                              PopupMenuButton(
                                color: Colors.black,
                                shape: const RoundedRectangleBorder(
                                    borderRadius:
                                        BorderRadius.all(Radius.circular(10))),
                                onSelected: (int selectedValue) async {
                                  if (afternoon == false) {
                                    if (selectedValue == 0) {
                                      final int userId =
                                          recordMorning[index].userId;
                                      final int id = recordMorning[index].id;
                                      final String type =
                                          recordMorning[index].type;
                                      final DateTime date =
                                          recordMorning[index].date;
                                      final String? note =
                                          recordMorning[index].note;
                                      final String code =
                                          recordMorning[index].code;
                                      await Navigator.of(context).push(
                                        MaterialPageRoute(
                                          builder: (ctx) => AttedancesEdit(
                                            id: id,
                                            userId: userId,
                                            type: type,
                                            date: date,
                                            note: note,
                                            code: code,
                                          ),
                                        ),
                                      );
                                      fetchAttendanceById();
                                    }
                                    if (selectedValue == 1) {
                                      showDialog(
                                        context: context,
                                        builder: (ctx) => AlertDialog(
                                          title: Text('${local?.areYouSure}'),
                                          content:
                                              Text('${local?.cannotUndone}'),
                                          actions: [
                                            OutlineButton(
                                              onPressed: () {
                                                Navigator.of(context).pop();
                                                deleteData(recordMorning[index]
                                                    .id as int);
                                              },
                                              child: Text('${local?.yes}'),
                                              borderSide: BorderSide(
                                                  color: Colors.green),
                                            ),
                                            OutlineButton(
                                              onPressed: () {
                                                Navigator.of(context).pop();
                                              },
                                              borderSide:
                                                  BorderSide(color: Colors.red),
                                              child: Text('${local?.no}'),
                                            )
                                          ],
                                        ),
                                      );
                                    }
                                    if (selectedValue == 2) {
                                      final int userId =
                                          recordMorning[index].userId;
                                      final int id = recordMorning[index].id;
                                      final String type =
                                          recordMorning[index].type;
                                      final DateTime date =
                                          recordMorning[index].date;
                                      final String note =
                                          recordMorning[index].note;
                                      final String userName =
                                          recordMorning[index].users!.name;
                                      final String image =
                                          recordMorning[index].users.image;
                                      await Navigator.of(context).push(
                                        MaterialPageRoute(
                                          builder: (ctx) =>
                                              ViewAttendanceScreen(
                                            id: id,
                                            userId: userId,
                                            type: type,
                                            date: date,
                                            note: note,
                                            userName: userName,
                                            image: image,
                                          ),
                                        ),
                                      );
                                    }
                                  }
                                },
                                itemBuilder: (_) => [
                                  PopupMenuItem(
                                    child: Text(
                                      '${local?.optionView}',
                                      style: kParagraph.copyWith(
                                          fontWeight: FontWeight.bold),
                                    ),
                                    value: 2,
                                  ),
                                  if (record.list[0].users!.role == 'admin')
                                    PopupMenuItem(
                                      child: Text(
                                        '${local?.edit}',
                                        style: kParagraph.copyWith(
                                            fontWeight: FontWeight.bold),
                                      ),
                                      value: 0,
                                    ),
                                  if (record.list[0].users!.role == 'admin')
                                    PopupMenuItem(
                                      child: Text(
                                        '${local?.delete}',
                                        style: kParagraph.copyWith(
                                            fontWeight: FontWeight.bold),
                                      ),
                                      value: 1,
                                    ),
                                ],
                                icon: const Icon(Icons.more_vert),
                              ),
                            ],
                          ),
                        ],
                      ),
                    );
            },
            itemCount:
                afternoon ? recordAfternoon.length : recordMorning.length)
      ],
    );
  }

  Widget _buildOneDayResult(AttendanceWithDate record, BuildContext context) {
    AppLocalizations? local = AppLocalizations.of(context);
    bool isEnglish = isInEnglish(context);
    List onedayMorning = record.list
        .where((element) =>
            element.code != 'cin2' &&
            element.code != 'cout2' &&
            element.code != 'cin3' &&
            element.code != 'cout3')
        .toList();
    List ondayAfternoon = record.list
        .where((element) =>
            element.code != 'cin1' &&
            element.code != 'cout1' &&
            element.code != 'cin3' &&
            element.code != 'cout3')
        .toList();
    return ondayAfternoon.isEmpty && afternoon
        ? Column(
            children: [
              Text(
                '${local?.noAttendance}',
                style: kHeadingThree.copyWith(
                  fontWeight: FontWeight.bold,
                  color: Colors.white,
                ),
              ),
              SizedBox(
                height: isEnglish ? 30 : 0,
              ),
              Text(
                'ðŸ¤·ðŸ¼',
                style: TextStyle(
                  fontSize: 60,
                ),
              )
            ],
          )
        : onedayMorning.isEmpty && !afternoon
            ? Column(
                children: [
                  Text(
                    '${local?.noAttendance}',
                    style: kHeadingThree.copyWith(
                      fontWeight: FontWeight.bold,
                      color: Colors.white,
                    ),
                  ),
                  SizedBox(
                    height: isEnglish ? 30 : 0,
                  ),
                  Text(
                    'ðŸ¤·ðŸ¼',
                    style: TextStyle(
                      fontSize: 60,
                    ),
                  )
                ],
              )
            : ExpansionTile(
                collapsedBackgroundColor: Color(0xff254973),
                backgroundColor: Color(0xff254973),
                textColor: Colors.white,
                iconColor: Colors.white,
                initiallyExpanded: true,
                title: Text(
                  getDateStringFromDateTime(record.date),
                  style: const TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.w500,
                  ),
                ),
                children: [
                  ListView.builder(
                    shrinkWrap: true,
                    physics: const ClampingScrollPhysics(),
                    itemBuilder: (context, index) {
                      AppLocalizations? local = AppLocalizations.of(context);
                      bool isEnglish = isInEnglish(context);
                      return Container(
                        padding: const EdgeInsets.symmetric(
                          horizontal: 25,
                          vertical: 8,
                        ),
                        color: index % 2 == 0 ? kDarkestBlue : kBlue,
                        child: Row(
                          mainAxisAlignment: MainAxisAlignment.spaceBetween,
                          children: [
                            afternoon
                                ? Text(DateFormat('dd/MM/yyyy HH:mm').format(
                                    ondayAfternoon[index].date as DateTime))
                                : Text(
                                    DateFormat('dd/MM/yyyy HH:mm').format(
                                        onedayMorning[index].date as DateTime),
                                  ),
                            Row(
                              children: [
                                afternoon
                                    ? Text(
                                        ondayAfternoon[index].type == 'checkin'
                                            ? '${local?.checkIn}'
                                            : ondayAfternoon[index].type ==
                                                    'checkout'
                                                ? '${local?.checkOut}'
                                                : ondayAfternoon[index].type ==
                                                        'absent'
                                                    ? '${local?.absent}'
                                                    : ondayAfternoon[index]
                                                                .type ==
                                                            'permission'
                                                        ? '${local?.permission}'
                                                        : ondayAfternoon[index]
                                                            .type
                                                            .toString(),
                                        style: kParagraph)
                                    : Text(
                                        onedayMorning[index].type == 'checkin'
                                            ? '${local?.checkIn}'
                                            : onedayMorning[index].type ==
                                                    'checkout'
                                                ? '${local?.checkOut}'
                                                : onedayMorning[index].type ==
                                                        'absent'
                                                    ? '${local?.absent}'
                                                    : onedayMorning[index]
                                                                .type ==
                                                            'permission'
                                                        ? '${local?.permission}'
                                                        : onedayMorning[index]
                                                            .type
                                                            .toString(),
                                        style: kParagraph),
                                PopupMenuButton(
                                  color: Colors.black,
                                  shape: const RoundedRectangleBorder(
                                      borderRadius: BorderRadius.all(
                                          Radius.circular(10))),
                                  onSelected: (int selectedValue) async {
                                    if (afternoon == false) {
                                      if (selectedValue == 0) {
                                        final int userId =
                                            onedayMorning[index].userId;
                                        final int id = onedayMorning[index].id;
                                        final String type =
                                            onedayMorning[index].type;
                                        final DateTime date =
                                            onedayMorning[index].date;
                                        final String? note =
                                            onedayMorning[index].note;
                                        final String code =
                                            onedayMorning[index].code;
                                        await Navigator.of(context).push(
                                          MaterialPageRoute(
                                            builder: (ctx) => AttedancesEdit(
                                              id: id,
                                              userId: userId,
                                              type: type,
                                              date: date,
                                              note: note,
                                              code: code,
                                            ),
                                          ),
                                        );
                                        oneDayMorning = [];
                                        attendanceAllDisplay = [];
                                        fetchAttendanceById();
                                      }
                                      if (selectedValue == 1) {
                                        showDialog(
                                          context: context,
                                          builder: (ctx) => AlertDialog(
                                            title: Text('${local?.areYouSure}'),
                                            content:
                                                Text('${local?.cannotUndone}'),
                                            actions: [
                                              OutlineButton(
                                                onPressed: () {
                                                  Navigator.of(context).pop();
                                                  deleteData(
                                                      onedayMorning[index].id
                                                          as int);
                                                },
                                                child: Text('Yes'),
                                                borderSide: BorderSide(
                                                    color: Colors.green),
                                              ),
                                              OutlineButton(
                                                onPressed: () {
                                                  Navigator.of(context).pop();
                                                },
                                                borderSide: BorderSide(
                                                    color: Colors.red),
                                                child: Text('No'),
                                              )
                                            ],
                                          ),
                                        );
                                      }
                                      if (selectedValue == 2) {
                                        final int userId =
                                            onedayMorning[index].userId;
                                        final int id = onedayMorning[index].id;
                                        final String type =
                                            onedayMorning[index].type;
                                        final DateTime date =
                                            onedayMorning[index].date;
                                        final String? note =
                                            onedayMorning[index].note;
                                        final String userName =
                                            onedayMorning[index].users!.name;
                                        final String image =
                                            onedayMorning[index].users.image;
                                        await Navigator.of(context).push(
                                          MaterialPageRoute(
                                            builder: (ctx) =>
                                                ViewAttendanceScreen(
                                              id: id,
                                              userId: userId,
                                              type: type,
                                              date: date,
                                              note: note,
                                              userName: userName,
                                              image: image,
                                            ),
                                          ),
                                        );
                                      }
                                    }
                                    if (afternoon == true) {
                                      if (selectedValue == 0) {
                                        final int userId =
                                            ondayAfternoon[index].userId;
                                        final int id = ondayAfternoon[index].id;
                                        final String type =
                                            ondayAfternoon[index].type;
                                        final DateTime date =
                                            ondayAfternoon[index].date;
                                        final String? note =
                                            ondayAfternoon[index].note;
                                        final String code =
                                            ondayAfternoon[index].code;
                                        await Navigator.of(context).push(
                                          MaterialPageRoute(
                                            builder: (ctx) => AttedancesEdit(
                                              id: id,
                                              userId: userId,
                                              type: type,
                                              date: date,
                                              note: note,
                                              code: code,
                                            ),
                                          ),
                                        );
                                        attendanceAllDisplay = [];
                                        fetchAttendanceById();
                                      }
                                      if (selectedValue == 1) {
                                        showDialog(
                                          context: context,
                                          builder: (ctx) => AlertDialog(
                                            title: Text('${local?.areYouSure}'),
                                            content:
                                                Text('${local?.cannotUndone}'),
                                            actions: [
                                              OutlineButton(
                                                onPressed: () {
                                                  Navigator.of(context).pop();
                                                  deleteData(
                                                      ondayAfternoon[index].id
                                                          as int);
                                                },
                                                child: Text('Yes'),
                                                borderSide: BorderSide(
                                                    color: Colors.green),
                                              ),
                                              OutlineButton(
                                                onPressed: () {
                                                  Navigator.of(context).pop();
                                                },
                                                borderSide: BorderSide(
                                                    color: Colors.red),
                                                child: Text('No'),
                                              )
                                            ],
                                          ),
                                        );
                                      }
                                      if (selectedValue == 2) {
                                        final int userId =
                                            onedayMorning[index].userId;
                                        final int id = onedayMorning[index].id;
                                        final String type =
                                            onedayMorning[index].type;
                                        final DateTime date =
                                            onedayMorning[index].date;
                                        final String note =
                                            onedayMorning[index].note;
                                        final String userName =
                                            onedayMorning[index].users!.name;
                                        final String image =
                                            onedayMorning[index].users.image;
                                        await Navigator.of(context).push(
                                          MaterialPageRoute(
                                            builder: (ctx) =>
                                                ViewAttendanceScreen(
                                              id: id,
                                              userId: userId,
                                              type: type,
                                              date: date,
                                              note: note,
                                              userName: userName,
                                              image: image,
                                            ),
                                          ),
                                        );
                                      }
                                    }
                                  },
                                  itemBuilder: (_) => [
                                    PopupMenuItem(
                                      child: Text('${local?.optionView}',
                                          style: kParagraph.copyWith(
                                              fontWeight: FontWeight.bold)),
                                      value: 2,
                                    ),
                                    if (record.list[0].users!.role == 'admin')
                                      PopupMenuItem(
                                        child: Text('${local?.edit}',
                                            style: kParagraph.copyWith(
                                                fontWeight: FontWeight.bold)),
                                        value: 0,
                                      ),
                                    if (record.list[0].users!.role == 'admin')
                                      PopupMenuItem(
                                        child: Text('${local?.delete}',
                                            style: kParagraph.copyWith(
                                                fontWeight: FontWeight.bold)),
                                        value: 1,
                                      ),
                                  ],
                                  icon: const Icon(Icons.more_vert),
                                )
                              ],
                            ),
                          ],
                        ),
                      );
                    },
                    itemCount: afternoon
                        ? ondayAfternoon.length
                        : onedayMorning.length,
                  )
                ],
              );
  }

  Widget _buildNowResult(AttendanceWithDate record, BuildContext context) {
    AppLocalizations? local = AppLocalizations.of(context);
    bool isEnglish = isInEnglish(context);
    List recordMorning = record.list
        .where((element) =>
            element.code != 'cin2' &&
            element.code != 'cout2' &&
            element.code != 'cin3' &&
            element.code != 'cout3')
        .toList();
    List recordAfternoon = record.list
        .where((element) =>
            element.code != 'cin1' &&
            element.code != 'cout1' &&
            element.code != 'cin3' &&
            element.code != 'cout3')
        .toList();
    return recordAfternoon.isEmpty && afternoon
        ? Column(
            children: [
              Text(
                '${local?.noAttendance}',
                style: kHeadingThree.copyWith(
                  fontWeight: FontWeight.bold,
                  color: Colors.white,
                ),
              ),
              SizedBox(
                height: isEnglish ? 30 : 0,
              ),
              Text(
                'ðŸ¤·ðŸ¼',
                style: TextStyle(
                  fontSize: 60,
                ),
              )
            ],
          )
        : recordMorning.isEmpty && !afternoon
            ? Column(
                children: [
                  Text(
                    '${local?.noAttendance}',
                    style: kHeadingThree.copyWith(
                      fontWeight: FontWeight.bold,
                      color: Colors.white,
                    ),
                  ),
                  SizedBox(
                    height: isEnglish ? 30 : 0,
                  ),
                  Text(
                    'ðŸ¤·ðŸ¼',
                    style: TextStyle(
                      fontSize: 60,
                    ),
                  )
                ],
              )
            : ExpansionTile(
                collapsedBackgroundColor: Color(0xff254973),
                backgroundColor: Color(0xff254973),
                textColor: Colors.white,
                iconColor: Colors.white,
                initiallyExpanded: true,
                title: Text(
                  getDateStringFromDateTime(record.date),
                  style: const TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.w500,
                  ),
                ),
                children: [
                  ListView.builder(
                    shrinkWrap: true,
                    physics: const ClampingScrollPhysics(),
                    itemBuilder: (context, index) {
                      AppLocalizations? local = AppLocalizations.of(context);
                      bool isEnglish = isInEnglish(context);
                      return Container(
                        padding: const EdgeInsets.symmetric(
                          horizontal: 25,
                          vertical: 8,
                        ),
                        color: index % 2 == 0 ? kDarkestBlue : kBlue,
                        child: Row(
                          mainAxisAlignment: MainAxisAlignment.spaceBetween,
                          children: [
                            afternoon
                                ? Text(DateFormat('dd/MM/yyyy HH:mm').format(
                                    recordAfternoon[index].date as DateTime))
                                : Text(
                                    DateFormat('dd/MM/yyyy HH:mm').format(
                                        recordMorning[index].date as DateTime),
                                  ),
                            Row(
                              children: [
                                afternoon
                                    ? Text(
                                        recordAfternoon[index].type == 'checkin'
                                            ? '${local?.checkIn}'
                                            : recordAfternoon[index].type ==
                                                    'checkout'
                                                ? '${local?.checkOut}'
                                                : recordAfternoon[index].type ==
                                                        'absent'
                                                    ? '${local?.absent}'
                                                    : recordAfternoon[index]
                                                                .type ==
                                                            'permission'
                                                        ? '${local?.permission}'
                                                        : recordAfternoon[index]
                                                            .type
                                                            .toString(),
                                        style: kParagraph)
                                    : Text(
                                        recordMorning[index].type == 'checkin'
                                            ? '${local?.checkIn}'
                                            : recordMorning[index].type ==
                                                    'checkout'
                                                ? '${local?.checkOut}'
                                                : recordMorning[index].type ==
                                                        'absent'
                                                    ? '${local?.absent}'
                                                    : recordMorning[index]
                                                                .type ==
                                                            'permission'
                                                        ? '${local?.permission}'
                                                        : recordMorning[index]
                                                            .type
                                                            .toString(),
                                        style: kParagraph),
                                PopupMenuButton(
                                  color: Colors.black,
                                  shape: const RoundedRectangleBorder(
                                      borderRadius: BorderRadius.all(
                                          Radius.circular(10))),
                                  onSelected: (int selectedValue) async {
                                    if (afternoon == false) {
                                      if (selectedValue == 0) {
                                        final int userId =
                                            recordMorning[index].userId as int;
                                        final int id =
                                            recordMorning[index].id as int;
                                        final String type = recordMorning[index]
                                            .type
                                            .toString();
                                        final DateTime date =
                                            recordMorning[index].date
                                                as DateTime;
                                        final String? note =
                                            recordMorning[index].note;
                                        final String code =
                                            recordMorning[index].code;
                                        await Navigator.of(context).push(
                                          MaterialPageRoute(
                                            builder: (ctx) => AttedancesEdit(
                                              id: id,
                                              userId: userId,
                                              type: type,
                                              date: date,
                                              note: note,
                                              code: code,
                                            ),
                                          ),
                                        );
                                        fetchAttendanceById();
                                      }
                                      if (selectedValue == 1) {
                                        showDialog(
                                          context: context,
                                          builder: (ctx) => AlertDialog(
                                            title: Text('${local?.areYouSure}'),
                                            content:
                                                Text('${local?.cannotUndone}'),
                                            actions: [
                                              OutlineButton(
                                                onPressed: () {
                                                  Navigator.of(context).pop();
                                                  deleteData(
                                                      recordMorning[index].id
                                                          as int);
                                                },
                                                child: Text('Yes'),
                                                borderSide: BorderSide(
                                                    color: Colors.green),
                                              ),
                                              OutlineButton(
                                                onPressed: () {
                                                  Navigator.of(context).pop();
                                                },
                                                borderSide: BorderSide(
                                                    color: Colors.red),
                                                child: Text('No'),
                                              )
                                            ],
                                          ),
                                        );
                                      }
                                      if (selectedValue == 2) {
                                        final int userId =
                                            recordMorning[index].userId as int;
                                        final int id =
                                            recordMorning[index].id as int;
                                        final String type = recordMorning[index]
                                            .type
                                            .toString();
                                        final DateTime date =
                                            recordMorning[index].date
                                                as DateTime;
                                        final String? note =
                                            recordMorning[index].note;
                                        final String userName =
                                            recordMorning[index]
                                                .users!
                                                .name
                                                .toString();
                                        final String image =
                                            recordMorning[index]
                                                .users!
                                                .image
                                                .toString();
                                        await Navigator.of(context).push(
                                          MaterialPageRoute(
                                            builder: (ctx) =>
                                                ViewAttendanceScreen(
                                              id: id,
                                              userId: userId,
                                              type: type,
                                              date: date,
                                              note: note,
                                              userName: userName,
                                              image: image,
                                            ),
                                          ),
                                        );
                                      }
                                    }
                                    if (afternoon == true) {
                                      if (selectedValue == 0) {
                                        final int userId =
                                            recordAfternoon[index].userId;
                                        final int id =
                                            recordAfternoon[index].id;
                                        final String type =
                                            recordAfternoon[index].type;
                                        final DateTime date =
                                            recordAfternoon[index].date;
                                        final String? note =
                                            recordAfternoon[index].note;
                                        final String code =
                                            recordAfternoon[index].code;
                                        await Navigator.of(context).push(
                                          MaterialPageRoute(
                                            builder: (ctx) => AttedancesEdit(
                                              id: id,
                                              userId: userId,
                                              type: type,
                                              date: date,
                                              note: note,
                                              code: code,
                                            ),
                                          ),
                                        );
                                        fetchAttendanceById();
                                      }
                                      if (selectedValue == 1) {
                                        showDialog(
                                          context: context,
                                          builder: (ctx) => AlertDialog(
                                            title: Text('${local?.areYouSure}'),
                                            content:
                                                Text('${local?.cannotUndone}'),
                                            actions: [
                                              OutlineButton(
                                                onPressed: () {
                                                  Navigator.of(context).pop();
                                                  deleteData(
                                                      recordAfternoon[index].id
                                                          as int);
                                                },
                                                child: Text('Yes'),
                                                borderSide: BorderSide(
                                                    color: Colors.green),
                                              ),
                                              OutlineButton(
                                                onPressed: () {
                                                  Navigator.of(context).pop();
                                                },
                                                borderSide: BorderSide(
                                                    color: Colors.red),
                                                child: Text('No'),
                                              )
                                            ],
                                          ),
                                        );
                                      }
                                      if (selectedValue == 2) {
                                        final int userId =
                                            recordMorning[index].userId as int;
                                        final int id =
                                            recordMorning[index].id as int;
                                        final String type = recordMorning[index]
                                            .type
                                            .toString();
                                        final DateTime date =
                                            recordMorning[index].date
                                                as DateTime;
                                        final String note = recordMorning[index]
                                            .note
                                            .toString();
                                        final String userName =
                                            recordMorning[index]
                                                .users!
                                                .name
                                                .toString();
                                        final String image =
                                            recordMorning[index]
                                                .users!
                                                .image
                                                .toString();
                                        await Navigator.of(context).push(
                                          MaterialPageRoute(
                                            builder: (ctx) =>
                                                ViewAttendanceScreen(
                                              id: id,
                                              userId: userId,
                                              type: type,
                                              date: date,
                                              note: note,
                                              userName: userName,
                                              image: image,
                                            ),
                                          ),
                                        );
                                      }
                                    }
                                  },
                                  itemBuilder: (_) => [
                                    PopupMenuItem(
                                      child: Text('${local?.optionView}',
                                          style: kParagraph.copyWith(
                                              fontWeight: FontWeight.bold)),
                                      value: 2,
                                    ),
                                    if (recordMorning[0].users!.role == 'admin')
                                      PopupMenuItem(
                                        child: Text('${local?.edit}',
                                            style: kParagraph.copyWith(
                                                fontWeight: FontWeight.bold)),
                                        value: 0,
                                      ),
                                    if (recordMorning[0].users!.role == 'admin')
                                      PopupMenuItem(
                                        child: Text('${local?.delete}',
                                            style: kParagraph.copyWith(
                                                fontWeight: FontWeight.bold)),
                                        value: 1,
                                      ),
                                  ],
                                  icon: const Icon(Icons.more_vert),
                                )
                              ],
                            ),
                          ],
                        ),
                      );
                    },
                    itemCount: afternoon
                        ? recordAfternoon.length
                        : recordMorning.length,
                  ),
                ],
              );
  }

  Widget _buildAllResult(AttendanceWithDate record) {
    return ExpansionTile(
      collapsedBackgroundColor: Color(0xff254973),
      backgroundColor: Color(0xff254973),
      textColor: Colors.white,
      iconColor: Colors.white,
      initiallyExpanded: true,
      title: Text(
        getDateStringFromDateTime(record.date),
        style: const TextStyle(
          fontSize: 16,
          fontWeight: FontWeight.w500,
        ),
      ),
      children: [
        ListView.builder(
          itemBuilder: (context, index) {
            AppLocalizations? local = AppLocalizations.of(context);
            bool isEnglish = isInEnglish(context);
            return Container(
              padding: const EdgeInsets.symmetric(
                horizontal: 25,
                vertical: 8,
              ),
              color: index % 2 == 0 ? kDarkestBlue : kBlue,
              child: Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  Text(
                    DateFormat('dd/MM/yyyy HH:mm')
                        .format(record.list[index].date as DateTime),
                  ),
                  Row(
                    children: [
                      Text(
                        record.list[index].type == 'checkin'
                            ? '${local?.checkIn}'
                            : record.list[index].type == 'checkout'
                                ? '${local?.checkOut}'
                                : record.list[index].type == 'absent'
                                    ? '${local?.absent}'
                                    : record.list[index].type == 'permission'
                                        ? '${local?.permission}'
                                        : record.list[index].type.toString(),
                      ),
                      PopupMenuButton(
                        color: Colors.black,
                        shape: const RoundedRectangleBorder(
                            borderRadius:
                                BorderRadius.all(Radius.circular(10))),
                        onSelected: (int selectedValue) async {
                          if (selectedValue == 0) {
                            final int userId = record.list[index].userId as int;
                            final int id = record.list[index].id as int;
                            final String type =
                                record.list[index].type.toString();
                            final DateTime date =
                                record.list[index].date as DateTime;
                            final String? note = record.list[index].note;
                            final String code =
                                record.list[index].code.toString();
                            await Navigator.of(context).push(
                              MaterialPageRoute(
                                builder: (ctx) => AttedancesEdit(
                                  id: id,
                                  userId: userId,
                                  type: type,
                                  date: date,
                                  note: note,
                                  code: code,
                                ),
                              ),
                            );
                            fetchAllAttendance();
                          }
                          if (selectedValue == 1) {
                            showDialog(
                              context: context,
                              builder: (ctx) => AlertDialog(
                                title: Text('${local?.areYouSure}'),
                                content: Text('${local?.cannotUndone}'),
                                actions: [
                                  OutlineButton(
                                    onPressed: () {
                                      Navigator.of(context).pop();
                                      deleteData(record.list[index].id as int);
                                    },
                                    child: Text('${local?.yes}'),
                                    borderSide: BorderSide(color: Colors.green),
                                  ),
                                  OutlineButton(
                                    onPressed: () {
                                      Navigator.of(context).pop();
                                    },
                                    borderSide: BorderSide(color: Colors.red),
                                    child: Text('${local?.no}'),
                                  )
                                ],
                              ),
                            );
                          }
                          if (selectedValue == 2) {
                            final int userId = record.list[index].userId as int;
                            final int id = record.list[index].id as int;
                            final String type =
                                record.list[index].type.toString();
                            final DateTime date =
                                record.list[index].date as DateTime;
                            final String? note = record.list[index].note;
                            final String userName =
                                record.list[index].users!.name.toString();
                            final String image =
                                record.list[index].users!.image.toString();
                            await Navigator.of(context).push(
                              MaterialPageRoute(
                                builder: (ctx) => ViewAttendanceScreen(
                                  id: id,
                                  userId: userId,
                                  type: type,
                                  date: date,
                                  note: note,
                                  userName: userName,
                                  image: image,
                                ),
                              ),
                            );
                          }
                        },
                        itemBuilder: (_) => [
                          PopupMenuItem(
                            child: Text(
                              '${local?.optionView}',
                              style: kParagraph.copyWith(
                                  fontWeight: FontWeight.bold),
                            ),
                            value: 2,
                          ),
                          if (record.list[0].users!.role == 'admin')
                            PopupMenuItem(
                              child: Text(
                                '${local?.edit}',
                                style: kParagraph.copyWith(
                                    fontWeight: FontWeight.bold),
                              ),
                              value: 0,
                            ),
                          if (record.list[0].users!.role == 'admin')
                            PopupMenuItem(
                              child: Text(
                                '${local?.delete}',
                                style: kParagraph.copyWith(
                                    fontWeight: FontWeight.bold),
                              ),
                              value: 1,
                            ),
                        ],
                        icon: const Icon(Icons.more_vert),
                      ),
                    ],
                  ),
                ],
              ),
            );
          },
          shrinkWrap: true,
          physics: const ClampingScrollPhysics(),
          itemCount: record.list.length,
        )
      ],
    );
  }

  ???????????

  fetchAttendanceById() async {
    try {
      _isLoading = true;
      List<AttendanceWithDate> attendanceDisplay =
          await _attendanceService.findManyByUserIdNoOvertime(
        userId: widget.id,
        start: startDate,
        end: endDate,
      );
      setState(() {
        _attendanceDisplay = attendanceDisplay;

        _isLoading = false;
        var now = DateTime.now();
        var today = attendanceDisplay.where((element) =>
            element.date.day == now.day &&
            element.date.month == now.month &&
            element.date.year == now.year);
        List todayFlat = today.expand((element) => element.list).toList();
        isToday = todayFlat
            .where((element) =>
                element.code != 'cin2' &&
                element.code != 'cout2' &&
                element.code != 'cout3' &&
                element.code != 'cin3')
            .toList();

        var oneDay = attendanceDisplay.where((element) =>
            element.date.day == startDate.day &&
            element.date.month == startDate.month &&
            element.date.year == startDate.year);
        onedayList = oneDay.toList();
        List oneDayFlat = oneDay.expand((element) => element.list).toList();
        oneDayMorning = oneDayFlat
            .where((element) =>
                element.code != 'cin2' &&
                element.code != 'cout2' &&
                element.code != 'cin3' &&
                element.code != 'cout3')
            .toList();
        oneDayNoon = oneDayFlat
            .where((element) =>
                element.code != 'cin1' &&
                element.code != 'cout1' &&
                element.code != 'cin3' &&
                element.code != 'cout3')
            .toList();
        todayPresent = isToday.where((element) => checkPresent(element)).length;
        todayLate = isToday.where((element) => checkLate(element)).length;
        todayAbsent = isToday.where((element) => checkAbsent(element)).length;
        todayPermission =
            isToday.where((element) => checkPermission(element)).length;
        onedayPresent =
            oneDayMorning.where((element) => checkPresent(element)).length;
        onedayLate =
            oneDayMorning.where((element) => checkLate(element)).length;
        onedayAbsent =
            oneDayMorning.where((element) => checkAbsent(element)).length;
        onedayPermission =
            oneDayMorning.where((element) => checkPermission(element)).length;

        isTodayNoon = todayFlat
            .where((element) =>
                element.code != 'cin1' &&
                element.code != 'cout1' &&
                element.code != 'cout3' &&
                element.code != 'cin3')
            .toList();
        todayPresentNoon =
            isTodayNoon.where((element) => checkPresentNoon(element)).length;
        todayLateNoon =
            isTodayNoon.where((element) => checkLateNoon(element)).length;
        todayAbsentNoon =
            isTodayNoon.where((element) => checkAbsentNoon(element)).length;
        todayPermissionNoon =
            isTodayNoon.where((element) => checkPermissionNoon(element)).length;
        onedayPresentNoon =
            oneDayNoon.where((element) => checkPresentNoon(element)).length;
        onedayLateNoon =
            oneDayNoon.where((element) => checkLateNoon(element)).length;
        onedayAbsentNoon =
            oneDayNoon.where((element) => checkAbsentNoon(element)).length;
        onedayPermissionNoon =
            oneDayNoon.where((element) => checkPermissionNoon(element)).length;
      });
      attendanceList = _attendanceDisplay;
    } catch (e) {}
  }

  ???????????

  fetchLate() async {
    var pc = await _attendanceService.countLateByUserId(
      userId: widget.id,
      start: startDate,
      end: endDate,
    );
    if (mounted) {
      setState(() {
        lateMorning = pc;
      });
    }
  }

  fetchLateNoon() async {
    var pc = await _attendanceService.countLateNoonByUserId(
      userId: widget.id,
      start: startDate,
      end: endDate,
    );
    if (mounted) {
      setState(() {
        lateAfternoon = pc;
      });
    }
  }

  fetchAbsent() async {
    _isLoading = true;
    var pc = await _attendanceService.countAbsentByUserId(
      userId: widget.id,
      start: startDate,
      end: endDate,
    );
    if (mounted) {
      setState(() {
        absentMorning = pc;
        _isLoading = false;
      });
    }
  }

  fetchAbsentNoon() async {
    var pc = await _attendanceService.countAbsentNoonByUserId(
      userId: widget.id,
      start: startDate,
      end: endDate,
    );
    if (mounted) {
      setState(() {
        absentAfternoon = pc;
      });
    }
  }

  fetchPermission() async {
    var pc = await _attendanceService.countPermissionByUserId(
      userId: widget.id,
      start: startDate,
      end: endDate,
    );
    if (mounted) {
      setState(() {
        permissionMorning = pc;
      });
    }
  }

  fetchPermissionNoon() async {
    var pc = await _attendanceService.countPermissionNoonByUserId(
      userId: widget.id,
      start: startDate,
      end: endDate,
    );
    if (mounted) {
      setState(() {
        permissionAfternoon = pc;
      });
    }
  }

  fetchPresent() async {
    var pc = await _attendanceService.countPresentByUserId(
      userId: widget.id,
      start: startDate,
      end: endDate,
    );
    if (mounted) {
      setState(() {
        presentMorning = pc;
      });
    }
  }

  fetchPresentNoon() async {
    var pc = await _attendanceService.countPresentNoonByUserId(
      userId: widget.id,
      start: startDate,
      end: endDate,
    );
    if (mounted) {
      setState(() {
        presentAfternoon = pc;
      });
    }
  }

  getPresent() async {
    var pc = await _attendanceService.countPresent(widget.id);
    if (mounted) {
      setState(() {
        countPresent = pc;
      });
    }
  }

  getPresentNoon() async {
    var pc = await _attendanceService.countPresentNoon(widget.id);
    if (mounted) {
      setState(() {
        countPresentNoon = pc;
      });
    }
  }

  getLate() async {
    var pc = await _attendanceService.countLate(widget.id);
    if (mounted) {
      setState(() {
        countLate = pc;
      });
    }
  }

  getLateNoon() async {
    var pc = await _attendanceService.countLateNoon(widget.id);
    if (mounted) {
      setState(() {
        countLateNoon = pc;
      });
    }
  }

  getAbsent() async {
    var pc = await _attendanceService.countAbsent(widget.id);
    if (mounted) {
      setState(() {
        countAbsent = pc;
      });
    }
  }

  getAbsentNoon() async {
    var pc = await _attendanceService.countAbsentNoon(widget.id);
    if (mounted) {
      setState(() {
        countAbsentNoon = pc;
      });
    }
  }

  getPermission() async {
    var pc = await _attendanceService.countPermission(widget.id);
    if (mounted) {
      setState(() {
        countPermission = pc;
      });
    }
  }

  getPermissionNoon() async {
    var pc = await _attendanceService.countPermissionNoon(widget.id);
    if (mounted) {
      setState(() {
        countPermissionNoon = pc;
      });
    }
  }

  getPresentAll() async {
    var pc = await _attendanceService.countPresentAll(widget.id);
    if (mounted) {
      setState(() {
        presentAll = pc;
      });
    }
  }

  getAbsentAll() async {
    var pc = await _attendanceService.countAbsentAll(widget.id);
    if (mounted) {
      setState(() {
        absentAll = pc;
      });
    }
  }

  getLateAll() async {
    var pc = await _attendanceService.countLateAll(widget.id);
    if (mounted) {
      setState(() {
        lateAll = pc;
      });
    }
  }

  getPermissionAll() async {
    var pc = await _attendanceService.countPermissionAll(widget.id);
    if (mounted) {
      setState(() {
        permissionAll = pc;
      });
    }
  }

 ???????????

   // fetchAllAttendance() async {
  //   _isLoading = true;
  //   try {
  //     List<AttendancesWithDate> attendanceDisplay = await _attendanceService
  //         .findManyByUserIdNoOvertime(userId: widget.id);
  //     setState(() {
  //       _attendanceAll = attendanceDisplay;
  //       _isLoading = false;
  //     });
  //     List flat = _attendanceAll.expand((element) => element.list).toList();
  //     attendanceListAll = flat.toList();
  //   } catch (e) {}
  // }

  checkLate(Attendance element) {
    if (element.code == 'cin1') {
      if (element.type == 'checkin') {
        if (element.date!.hour == 7) {
          if (element.date!.minute >= 16) {
            return true;
          } else {
            return false;
          }
        } else if (element.date!.hour > 7) {
          return true;
        } else {
          return false;
        }
      } else {
        return false;
      }
    } else {
      return false;
    }
  }

  checkLateNoon(Attendance element) {
    if (element.code == 'cin2') {
      if (element.type == 'checkin') {
        if (element.date!.hour == 13) {
          if (element.date!.minute >= 16) {
            return true;
          } else {
            return false;
          }
        } else if (element.date!.hour > 13) {
          return true;
        } else {
          return false;
        }
      } else {
        return false;
      }
    } else {
      return false;
    }
  }

  checkPresent(Attendance element) {
    if (element.code == 'cin1') {
      if (element.type == 'checkin') {
        if (element.date!.hour <= 7) {
          if (element.date!.minute <= 15) {
            return true;
          } else {
            return false;
          }
        } else {
          return false;
        }
      } else {
        return false;
      }
    } else {
      return false;
    }
  }

  checkPresentNoon(Attendance element) {
    if (element.code == 'cin2') {
      if (element.type == 'checkin') {
        if (element.date!.hour <= 13) {
          if (element.date!.minute <= 15) {
            return true;
          } else {
            return false;
          }
        } else {
          return false;
        }
      } else {
        return false;
      }
    } else {
      return false;
    }
  }

  checkAbsent(Attendance element) {
    if (element.code == 'cin1') {
      if (element.type == 'absent') {
        return true;
      } else {
        return false;
      }
    } else {
      return false;
    }
  }

  checkAbsentNoon(Attendance element) {
    if (element.code == 'cin2') {
      if (element.type == 'absent') {
        return true;
      } else {
        return false;
      }
    } else {
      return false;
    }
  }

  checkPermission(Attendance element) {
    if (element.code == 'cin1') {
      if (element.type == 'permission') {
        return true;
      } else {
        return false;
      }
    } else {
      return false;
    }
  }

  checkPermissionNoon(Attendance element) {
    if (element.code == 'cin2') {
      if (element.type == 'permission') {
        return true;
      } else {
        return false;
      }
    } else {
      return false;
    }
  }

  fetchAttedancesById() async {
    try {
      List<AttendancesWithDate> attendanceDisplay =
          await _attendanceService.findManyAttendancesById(
        userId: 1,
        start: startDate,
        end: endDate,
      );
      setState(() {
        attendancesByIdDisplay = attendanceDisplay;

        var now = DateTime.now();
        var today = attendancesByIdDisplay.where((element) =>
            element.date.day == now.day &&
            element.date.month == now.month &&
            element.date.year == now.year);

        List todayFlat = today.expand((element) => element.list).toList();
        isToday = todayFlat;

        var oneDay = attendanceDisplay.where((element) =>
            element.date.day == startDate.day &&
            element.date.month == startDate.month &&
            element.date.year == startDate.year);
        onedayList = oneDay.toList();
        attendanceList = attendancesByIdDisplay;
        print(attendanceList);
      });
    } catch (err) {}
  }

  fetchAllAttendance() async {
    _isLoading = true;
    try {
      List<AttendancesWithDate> attendanceDisplay =
          await _attendanceService.findManyAttendancesById(userId: 1);
      setState(() {
        _attendanceAll = attendanceDisplay;
        _isLoading = false;
      });
      List flat = _attendanceAll.expand((element) => element.list).toList();
      attendanceListAll = flat.toList();
    } catch (e) {}
  }

  fetchManyAttendances() {
    try {
      _attendanceService.findManyAttendances().then((usersFromServer) {
        if (mounted) {
          setState(() {
            attendancesDisplay = [];
            attendancesDisplay.addAll(usersFromServer);
          });
        }
      });
    } catch (err) {}
  }

  fetchAttendanceByIdNoon() async {
    try {
      _isLoading = true;
      List<AttendanceWithDate> attendanceDisplay =
          await _attendanceService.findManyByUserIdNoOvertime(
        userId: widget.id,
        start: startDate,
        end: endDate,
      );
      setState(() {
        _attendanceDisplay = attendanceDisplay;
        _isLoading = false;
        var now = DateTime.now();
        var today = attendanceDisplay.where((element) =>
            element.date.day == now.day &&
            element.date.month == now.month &&
            element.date.year == now.year);
        List todayFlat = today.expand((element) => element.list).toList();
        var oneDay = attendanceDisplay.where((element) =>
            element.date.day == startDate.day &&
            element.date.month == startDate.month &&
            element.date.year == startDate.year);
        List oneDayFlat = oneDay.expand((element) => element.list).toList();
      });
      attendanceListNoon = _attendanceDisplay;
    } catch (e) {}
  }

????????